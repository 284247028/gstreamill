
    <div class="container-fluid">
        <div class="row setjob">
            <div class="col-lg-3 sidebar-menu" id="job_man_menu">
                <ul class="nav nav-stacked">
                    <li><a href="javascript:setting();"> <span class="glyphicon glyphicon-wrench"></span><span> Job Managment</span></a></li>
                    <li><a href="#" id="job_status"> <span class="glyphicon glyphicon-stats"></span><span> Job Status</span></a></li>
                    <li><a href="#" id="rm_job"><span> Job Delete</span></a></li>
                </ul>
            </div>
            <div class='col-lg-9 main-content'>
                <div id='job_editor_holder' style="display: none;"></div>
                <div id='encoder_conf_editor_holder' style="display: none;"></div>
                <div id='main_content'></div>
                <button class='btn btn-primary' id='putjob'>Save Job</button>
            </div>
        </div>
    </div>


    <script type="text/javascript">

    function setting () {
        var posting = $.get("getjob/%s", function (data) {

            if (data.result == "failure") {
                alert (data.reason);
                return;
            }

            var schemaName = data.data.type;
            var job_element = document.getElementById ('job_editor_holder');
            job_element.innerHTML = "";
            var job_editor = new JSONEditor (job_element, {
                schema: {
                    $ref: "schemas/" + schemaName + ".schema"
                },
                ajax: true,
                hidden: true
            });

            job_editor.on ('ready', function () {

                job_editor.setValue (data.data);
                var conf_element = document.getElementById ('main_content');
                conf_element.innerHTML = "";
                var conf_editor = new JSONEditor (conf_element, {
                    schema: {
                        $ref: "schemas/" + schemaName + ".conf"
                    },
                    ajax: true,
                    disable_collapse: true,
                    disable_edit_json: true,
                    disable_properties: true,
                    disable_array_add: true,
                    disable_array_delete: true,
                    disable_array_reorder: true,
                    theme: 'bootstrap3',
                    iconlib: 'bootstrap3',
                    template: 'hogan'
                });

                conf_editor.on ('ready', function () {
                    /* get name */
                    var name_editor = conf_editor.getEditor ('root.name');
                    name_editor.setValue (data.data.name);

                    var conf_value = conf_editor.getValue ();

                    /* get source parameters */
                    for (var key in conf_value.source) {
                        var subkeys = key.split ('@');
                        if (subkeys.length != 2) {
                            var key_editor = job_editor.getEditor ('root.source.' + key);
                            var value = key_editor.getValue ();
                            var node_conf = conf_editor.getEditor ('root.source.' + key);
                            node_conf.setValue (value);
                        } else {
                            var key_editor = job_editor.getEditor ('root.source.' + subkeys[1]);
                            var value = key_editor.getValue ();
                            var re = new RegExp (subkeys[0]);
                            var node_conf = conf_editor.getEditor ('root.source.' + key);
                            node_conf.setValue (re.exec (value)[1]);
                        }
                    }

                    /* get m3u8 streaming parameters */
                    if (job_editor.getEditor ('root.m3u8streaming')) {
                        for (var key in conf_value.m3u8streaming) {
                            var key_editor = job_editor.getEditor ('root.m3u8streaming.' + key);
                            var value = key_editor.getValue ();
                            var node_conf = conf_editor.getEditor ('root.m3u8streaming.' + key);
                            node_conf.setValue (value);
                        }
                    } else {
                        delete conf_value.m3u8streaming;
                        conf_editor.setValue (conf_value);
                    }

                    /* get encoders parameters */
                    var encoder_element = document.getElementById ('encoder_conf_editor_holder');
                    encoder_element.innerHTML = "";
                    var encoder_conf_editor = new JSONEditor (encoder_element, {
                        schema: {
                            $ref: 'schemas/encoder.conf'
                        },
                        ajax: true,
                        hidden: true
                    });
                    encoder_conf_editor.on ('ready', function () {
                        conf_value = conf_editor.getValue ();
                        encoder_conf_value = encoder_conf_editor.getValue ();
                        var encoders_editor = job_editor.getEditor ('root.encoders');
                        var encoders_value = encoders_editor.getValue ();
                        for (var i = 0; i < encoders_value.length; i++) {
                            for (var key in encoder_conf_value) {
                                var node_conf = encoder_conf_editor.getEditor ('root.' + key);
                                var key_editor = job_editor.getEditor ('root.encoders.' + i + '.' + key);
                                var value = key_editor.getValue ();
                                node_conf.setValue (value);
                            }
                            conf_value.encoders[i] = encoder_conf_editor.getValue ();
                        }
                        conf_editor.setValue (conf_value);

                        $('#rm_job').attr ('href', "javascript:rm_job (\"" + data.data.name + "\")");
                        $('#job_status').attr ('href', "javascript:status (\"" + data.data.name + "\")");

                        /* set putjob click event after encoder_conf ready */
                        $('#putjob').show().unbind ('click');
                        $("#putjob").click (function () {
                            conf_value = conf_editor.getValue ();

                            /* set source parameters */
                            for (var key in conf_value.source) {
                                var key_editor = job_editor.getEditor ('root.source.' + key);
                                if (!key_editor)
                                    continue;
                                key_editor.setValue (conf_value.source[key]);
                            }

                            /* set m3u8 parameters */
                            if (job_editor.getEditor ('root.m3u8streaming')) {
                                for (var key in conf_value.m3u8streaming) {
                                    var key_editor = job_editor.getEditor ('root.m3u8streaming.' + key);
                                    if (!key_editor)
                                        continue;
                                    key_editor.setValue (conf_value.m3u8streaming[key]);
                                }
                            }

                            /* set encoders paramerts */
                            for (var i = 0; i < conf_value.encoders.length; i++) {
                                for (var key in conf_value.encoders[i]) {
                                    var key_editor = job_editor.getEditor ('root.encoders.' + i + '.' + key);
                                    key_editor.setValue (conf_value.encoders[i][key]);
                                }
                            }

                            /* put job */
                            var name = data.data.name;
                            var value = job_editor.getValue ();
                            var posting = $.post ("putjob/" + name, JSON.stringify (value, null, 4), function (data) {
                                if (data.result == 'success') {
                                    alert (data.result);
                                } else {
                                    alert (data.result + '\n' + data.reason);
                                }
                            });
                        });
                    });
                });
            });
        });
    }

    function status (name) {
        $.get("/stat/gstreamill/job/" + name, function (data) {
            $('#putjob').hide ();

            if (data.result === 'failure') {
                alert (name + "'s stat not found.");
                return;
            }
            var conf_element = document.getElementById ('main_content');
            conf_element.innerHTML = "";
            var conf_editor = new JSONEditor (conf_element, {
                schema: {
                    $ref: "schemas/jobstat.schema"
                },
                ajax: true,
                disable_collapse: true,
                disable_edit_json: true,
                disable_properties: true,
                disable_array_add: true,
                disable_array_delete: true,
                disable_array_reorder: true,
                theme: 'bootstrap3',
                iconlib: 'bootstrap3',
                template: 'hogan'
            });

            conf_editor.on ('ready', function () {
                conf_editor.setValue (data.data);
                conf_editor.disable ();
            });
        });
    }

    function rm_job (name) {
        $.get("rmjob/" + name, function (data) {
            alert (data.result);
        });
    }

    $ (document).ready (function () {
        setting ();
    });

    </script>
