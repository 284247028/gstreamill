
    <div class="container-fluid">
        <div class="row">
            <!-- multistep form -->
            <form id="msform">
                <fieldset>
                    <div class="agroup">
                        <label for="name">Job name: </label></br>
                        Every job has a name, job name must be unique.</br>
                        <input type="text" name="name" id="name" placeholder="Job Name" style="border-bottom"/><br>
                    </div>
                    <div class="agroup">
                        <label for="source">Input type: </label></br>
                        Audio and video source, v4l2src, network or test source(videotestsrc for video and audiotestsrc for audio).</br>
                        <input type="radio" name="source" id="source" value="v4l2src"> v4l2src capture Device</br>
                        <input type="radio" name="source" id="source" value="networksrc"> Network</br>
                        <input type="radio" name="source" id="source" value="testsrc"> Test src</br>
                    </div>
                    <div class="agroup">
                        <label for="udp">Output type: </label></br>
                        have multi bitrate output? udp output? m3u8 output.</br>
                        multibitrate number: 
                        <select name="multibitrate" id="multibitrate">
                            <option value="1">one</option>
                            <option value="2">two</option>
                            <option value="3">three</option>
                        </select></br>
                        <input type=checkbox name="udp" id="udp"> UDP output</br>
                        <input type=checkbox name="m3u8" id="m3u8"> M3U8 output</br>
                    </div>
                    <input type="button" name="newjob" onclick="newLiveJob();" value="Create job" />
                </fieldset>
            </form>
            <div id='editor_holder' style="display: none;"></div>
            <div id='encoder_editor_holder' style="display: none;"></div>
        </div>
    </div>


    <script type="text/javascript">

    function newLiveJob()
    {
        var name = $("#name").val();
        if (name == "") {
            alert ("Input name please!");
            return;
        }

        var source = $("#source:checked").val();
        if (source == undefined) {
            alert ("select input type");
            return;
        }

        var element = document.getElementById('editor_holder');
        var editor = new JSONEditor (element, {
            schema: {
                $ref: "jobschemas/" + source + ".schema"
            },
            ajax: true,
            hidden: true
        });

        editor.on('ready', function() {

            /* job name */
            var jobName = editor.getEditor ('root.name');
            jobName.setValue (name);

            /* job type */
            var jobType = editor.getEditor ('root.type');
            jobType.setValue (source);

            /* count of encoders */
            var multiBitrate = parseInt($("#multibitrate").val());
            var encoderElement = document.getElementById('encoder_editor_holder');
            var encoderEditor = new JSONEditor (encoderElement, {
                schema: {
                    $ref: "jobschemas/encoder.schema"
                },
                ajax: true,
                hidden: true
            });
            encoderEditor.on ('ready', function () {

                var value = editor.getValue ();
                var encoderValue = encoderEditor.getValue ();

                /* udp output support? */
                var udp = $("#udp").is(":checked");
                if (!udp) {
                    delete encoderValue.udpstreaming;
                }

                /* m3u8 output support? */
                var m3u8 = $("#m3u8").is(":checked");
                if (!m3u8) {
                    delete value.m3u8streaming;
                }

                for (i = 0; i < multiBitrate; i++) {
                    value.encoders[i] = encoderValue;
                }

                var posting = $.post("putjob/" + name, JSON.stringify (value, null, 4), function (data) {
                    if (data.result == 'success') {
                        alert (data.result);
                    } else {
                        alert (data.result + '\n' + data.reason);
                    }
                });
            });
        });
    }
    </script>
