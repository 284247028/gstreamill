
    <div class="container-fluid">
        <div class="row newlivejob">
            <div class="panel panel-primary">
                <div class="panel-heading system" data-i18n="newlivejob.New Live Job"></div>
                <div class="panel-body">
                    <div class="row form-group col-lg-12">
                        <div class="col-lg-4">
                            <label class="pull-right system"  data-i18n="newlivejob.Job Name"></label>
                        </div>
                        <div class="col-lg-7">
                            <input type="text" class="form-control" id="jobname">
                        </div>
                    </div>
                    <div class="row form-group col-lg-12">
                        <div class="col-lg-4">
                            <label class="pull-right system"  data-i18n="newlivejob.Source Type"></label>
                        </div>
                        <div class="col-lg-7">
                            <label class="radio-inline">
                                <input type="radio" id="sourcetype" name= "sourcetype" value="v4l2src"> v4l2src
                            </label>
                            <label class="radio-inline">
                                <input type="radio" id="sourcetype" name= "sourcetype" value="networksrc"> networksrc
                            </label>
                            <label class="radio-inline">
                                <input type="radio" id="sourcetype" name= "sourcetype" value="testsrc"> testsrc
                            </label>
                        </div>
                    </div>
                    <div class="row form-group col-lg-12">
                        <div class="col-lg-4">
                            <label class="pull-right system"  data-i18n="newlivejob.Encoder Count"></label>
                        </div>
                        <div class="col-lg-7">
                            <input type="text" class="form-control" id="encodercount">
                        </div>
                    </div>
                    <div class="row form-group col-lg-12">
                        <div class="col-lg-4">
                            <label class="pull-right system"  data-i18n="newlivejob.UDP Output"></label>
                        </div>
                        <div class="col-lg-7">
                            <label class="checkbox-inline">
                                <input type="checkbox" id="udpoutput" value="option3"> <span data-i18n="newlivejob.Check for UDP output"></span>
                            </label>
                        </div>
                    </div>
                    <div class="row form-group col-lg-12">
                        <div class="col-lg-4">
                            <label class="pull-right system"  data-i18n="newlivejob.M3U8 Output"></label>
                        </div>
                        <div class="col-lg-7">
                            <label class="checkbox-inline">
                                <input type="checkbox" id="m3u8output" value="option3"> <span data-i18n="newlivejob.Check for M3u8 output"></span>
                            </label>
                        </div>
                    </div>
                    <button class='btn btn-primary pull-right' id='newlivejob' data-i18n="newlivejob.New Live Job"></button>
                </div>
            </div>
            <div id='job_editor_holder' style="display: none;"></div>
            <div id='encoder_editor_holder' style="display: none;"></div>
        </div>
    </div>


    <script type="text/javascript">

    $ (document).ready (function () {
        /* load configure */
        $.get("/admin/getconf", function (data) {
            if (data.result == "success") {
                Document.GstreamillConf.conf = data.data;
            } else {
                alert ("get configure failure: " + data.reason);
                return;
            }

            $("#newlivejob").click (function () {
                var job_element = document.getElementById('job_editor_holder');

                sourcetype_value = $("#sourcetype:checked").val ();
                var job_editor = new JSONEditor (job_element, {
                    schema: {
                        $ref: 'schemas/' + sourcetype_value + '.schema'
                    },
                    ajax: true,
                    hidden: true
                });
    
                job_editor.on ('ready', function() {
                    var name_editor = job_editor.getEditor ('root.name');
                    var name_value = $("#jobname").val ();
                    if (name_value == "") {
                        alert ("Set name please");
                        return;
                    }
                    name_editor.setValue (name_value);
        
                    var job_type = job_editor.getEditor ('root.type');
                    job_type.setValue (sourcetype_value);
        
                    var encoder_element = document.getElementById('encoder_editor_holder');
                    var encoder_editor = new JSONEditor (encoder_element, {
                        schema: {
                            $ref: 'schemas/encoder.schema'
                        },
                        ajax: true,
                        hidden: true
                    });
    
                    encoder_editor.on ('ready', function () {
                        var job_value = job_editor.getValue ();
                        var encoder_value = encoder_editor.getValue ();

                        var udpoutput_value = $("#udpoutput").val ();
                        if (!udpoutput_value) {
                            delete encoder_value.udpstreaming;
                        }

                        var m3u8output_value = $("#m3u8output").val ();
                        if (!m3u8output_value) {
                            delete job_value.m3u8streaming;
                        }

                        encodercount_value = $("#encodercount").val ();
                        for (i = 0; i < encodercount_value; i++) {
                            job_value.encoders[i] = encoder_value;
                        }

                        $.post("putjob/" + name_value, JSON.stringify (job_value, null, 4), function (data) {
                            if (data.result == 'success') {
                                alert (data.result);
                                window.location.replace("joblist.html");
                            } else {
                                alert (data.result + '\n' + data.reason);
                            }
                        });
                    });
                });
            });

            $.i18n.init({
                lng: Document.GstreamillConf.language[Document.GstreamillConf.conf.language]
            }, function(t) {
                $(".nav").i18n ();
                $(".newlivejob").i18n ();
            });

        });
    });

    </script>
